[gd_scene load_steps=26 format=3 uid="uid://bv8xk4m0q3wtn"]

[ext_resource type="PackedScene" uid="uid://c2kqr5m8vnh1p" path="res://scenes/player/player.tscn" id="1_player"]
[ext_resource type="PackedScene" uid="uid://c3y8vn0m8w2qh" path="res://scenes/npcs/elena_daughter.tscn" id="2_elena"]
[ext_resource type="Script" path="res://scripts/ui/dialogue_ui.gd" id="3_dialogue_ui"]
[ext_resource type="PackedScene" uid="uid://cx3j8vk7mlbxn" path="res://scenes/ui/debug_interaction_panel.tscn" id="4_debug_panel"]
[ext_resource type="PackedScene" uid="uid://bk3j9vk8mlcxo" path="res://scenes/ui/debug_console.tscn" id="5_debug_console"]
[ext_resource type="Script" path="res://scripts/world/scene_trigger.gd" id="6_scene_trigger"]
[ext_resource type="Script" path="res://scripts/world/world_solid.gd" id="7_world_solid"]
[ext_resource type="Script" path="res://scripts/world/generatable_asset.gd" id="8_generatable_asset"]
[ext_resource type="Script" path="res://scripts/debug/nav_debug_overlay.gd" id="9_nav_debug"]
[ext_resource type="Texture2D" path="res://assets/generated/foundations/foundation_shop.png" id="10_foundation_shop"]
[ext_resource type="Texture2D" path="res://assets/generated/foundations/foundation_tavern.png" id="11_foundation_tavern"]
[ext_resource type="Texture2D" path="res://assets/generated/foundations/foundation_blacksmith.png" id="12_foundation_blacksmith"]
[ext_resource type="Texture2D" path="res://assets/generated/foundations/foundation_house.png" id="13_foundation_house"]
[ext_resource type="Texture2D" path="res://assets/generated/shadows/shadow_shop.png" id="14_shadow_shop"]
[ext_resource type="Texture2D" path="res://assets/generated/shadows/shadow_tavern.png" id="15_shadow_tavern"]
[ext_resource type="Texture2D" path="res://assets/generated/shadows/shadow_blacksmith.png" id="16_shadow_blacksmith"]
[ext_resource type="Texture2D" path="res://assets/generated/shadows/shadow_house.png" id="17_shadow_house"]
[ext_resource type="Texture2D" path="res://assets/generated/buildings/gregor_shop.png" id="18_building_shop"]
[ext_resource type="Texture2D" path="res://assets/generated/buildings/tavern.png" id="19_building_tavern"]
[ext_resource type="Texture2D" path="res://assets/generated/buildings/blacksmith.png" id="20_building_blacksmith"]
[ext_resource type="Texture2D" path="res://assets/generated/buildings/village_house_1.png" id="21_building_house"]
[ext_resource type="Texture2D" path="res://assets/generated/path_endpoints/path_to_shop_door.png" id="22_path_shop"]
[ext_resource type="Texture2D" path="res://assets/generated/path_endpoints/path_to_tavern_door.png" id="23_path_tavern"]
[ext_resource type="Texture2D" path="res://assets/generated/path_endpoints/path_to_blacksmith.png" id="24_path_blacksmith"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_door_trigger"]
size = Vector2(60, 30)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_door_trigger_large"]
size = Vector2(100, 50)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_building_medium"]
size = Vector2(128, 96)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_building_large"]
size = Vector2(160, 128)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_well"]
size = Vector2(64, 64)

[node name="ThornhavenSquare" type="Node2D"]

[node name="SceneBackground" type="Node2D" parent="."]
z_index = -10

[node name="Placeholder" type="ColorRect" parent="SceneBackground"]
offset_left = -512.0
offset_top = -512.0
offset_right = 512.0
offset_bottom = 512.0
color = Color(0.22, 0.31, 0.18, 1)

[node name="Asset" type="Node" parent="SceneBackground"]
script = ExtResource("8_generatable_asset")
asset_id = "thornhaven_square_scene"
generation_prompt = "pixel art medieval village square, top-down RPG view, cobblestone plaza center, dirt paths leading north south east west, wooden shop upper-left with shingled roof, tavern upper-right with chimney, stone blacksmith left side, thatched cottage right side, stone well in center plaza, autumn trees at edges, warm lighting, 16-bit SNES style, fantasy game tileset"
asset_type = "terrain"
generation_seed = 1000
analyze_after_generation = true

[node name="Foundations" type="Node2D" parent="."]
z_index = -10

[node name="ShopFoundation" type="Sprite2D" parent="Foundations"]
position = Vector2(-240, -176)
scale = Vector2(2, 2)
texture = ExtResource("10_foundation_shop")

[node name="TavernFoundation" type="Sprite2D" parent="Foundations"]
position = Vector2(240, -192)
scale = Vector2(2, 2)
texture = ExtResource("11_foundation_tavern")

[node name="BlacksmithFoundation" type="Sprite2D" parent="Foundations"]
position = Vector2(-320, 32)
scale = Vector2(2, 2)
texture = ExtResource("12_foundation_blacksmith")

[node name="HouseFoundation" type="Sprite2D" parent="Foundations"]
position = Vector2(320, 32)
scale = Vector2(2, 2)
texture = ExtResource("13_foundation_house")

[node name="Shadows" type="Node2D" parent="."]
z_index = -5

[node name="ShopShadow" type="Sprite2D" parent="Shadows"]
position = Vector2(-232, -168)
scale = Vector2(2, 2)
modulate = Color(1, 1, 1, 0.3)
texture = ExtResource("14_shadow_shop")

[node name="TavernShadow" type="Sprite2D" parent="Shadows"]
position = Vector2(252, -180)
scale = Vector2(2, 2)
modulate = Color(1, 1, 1, 0.3)
texture = ExtResource("15_shadow_tavern")

[node name="BlacksmithShadow" type="Sprite2D" parent="Shadows"]
position = Vector2(-312, 40)
scale = Vector2(2, 2)
modulate = Color(1, 1, 1, 0.25)
texture = ExtResource("16_shadow_blacksmith")

[node name="HouseShadow" type="Sprite2D" parent="Shadows"]
position = Vector2(326, 38)
scale = Vector2(2, 2)
modulate = Color(1, 1, 1, 0.3)
texture = ExtResource("17_shadow_house")

[node name="PathEndpoints" type="Node2D" parent="."]
z_index = -12

[node name="ShopPathEndpoint" type="Sprite2D" parent="PathEndpoints"]
position = Vector2(-240, -128)
scale = Vector2(2, 2)
texture = ExtResource("22_path_shop")

[node name="TavernPathEndpoint" type="Sprite2D" parent="PathEndpoints"]
position = Vector2(240, -128)
scale = Vector2(2, 2)
texture = ExtResource("23_path_tavern")

[node name="BlacksmithPathEndpoint" type="Sprite2D" parent="PathEndpoints"]
position = Vector2(-320, 100)
scale = Vector2(2, 2)
texture = ExtResource("24_path_blacksmith")

[node name="Buildings" type="Node2D" parent="."]
z_index = 10

[node name="GregorShop" type="Sprite2D" parent="Buildings"]
position = Vector2(-240, -192)
scale = Vector2(2, 2)
texture = ExtResource("18_building_shop")

[node name="Tavern" type="Sprite2D" parent="Buildings"]
position = Vector2(240, -208)
scale = Vector2(2, 2)
texture = ExtResource("19_building_tavern")

[node name="Blacksmith" type="Sprite2D" parent="Buildings"]
position = Vector2(-320, 16)
scale = Vector2(2, 2)
texture = ExtResource("20_building_blacksmith")

[node name="House1" type="Sprite2D" parent="Buildings"]
position = Vector2(320, 16)
scale = Vector2(2, 2)
texture = ExtResource("21_building_house")

[node name="NavigationRegion2D" type="NavigationRegion2D" parent="."]

[node name="Collisions" type="Node2D" parent="."]

[node name="GregorShopCollision" type="StaticBody2D" parent="Collisions"]
position = Vector2(-240, -192)
script = ExtResource("7_world_solid")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Collisions/GregorShopCollision"]
shape = SubResource("RectangleShape2D_building_medium")

[node name="TavernCollision" type="StaticBody2D" parent="Collisions"]
position = Vector2(240, -208)
script = ExtResource("7_world_solid")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Collisions/TavernCollision"]
shape = SubResource("RectangleShape2D_building_large")

[node name="BlacksmithCollision" type="StaticBody2D" parent="Collisions"]
position = Vector2(-320, -16)
script = ExtResource("7_world_solid")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Collisions/BlacksmithCollision"]
shape = SubResource("RectangleShape2D_building_medium")

[node name="House1Collision" type="StaticBody2D" parent="Collisions"]
position = Vector2(320, 16)
script = ExtResource("7_world_solid")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Collisions/House1Collision"]
shape = SubResource("RectangleShape2D_building_medium")

[node name="WellCollision" type="StaticBody2D" parent="Collisions"]
position = Vector2(0, 32)
script = ExtResource("7_world_solid")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Collisions/WellCollision"]
shape = SubResource("RectangleShape2D_well")

[node name="EntryPoints" type="Node2D" parent="."]

[node name="GregorShopEntry" type="Area2D" parent="EntryPoints"]
position = Vector2(-240, -128)
script = ExtResource("6_scene_trigger")
target_location = "thornhaven_gregor_shop"
target_spawn_point = "from_exterior"
prompt_text = "Enter Shop"

[node name="CollisionShape2D" type="CollisionShape2D" parent="EntryPoints/GregorShopEntry"]
shape = SubResource("RectangleShape2D_door_trigger")

[node name="InteractionPrompt" type="Label" parent="EntryPoints/GregorShopEntry"]
z_index = 10
visible = false
offset_left = -50.0
offset_top = -40.0
offset_right = 50.0
offset_bottom = -15.0
theme_override_colors/font_color = Color(1, 1, 1, 1)
theme_override_colors/font_outline_color = Color(0, 0, 0, 1)
theme_override_constants/outline_size = 3
theme_override_font_sizes/font_size = 16
text = "[E] Enter Shop"
horizontal_alignment = 1

[node name="TavernEntry" type="Area2D" parent="EntryPoints"]
position = Vector2(240, -128)
script = ExtResource("6_scene_trigger")
target_location = "thornhaven_tavern"
target_spawn_point = "from_exterior"
prompt_text = "Enter Tavern"

[node name="CollisionShape2D" type="CollisionShape2D" parent="EntryPoints/TavernEntry"]
shape = SubResource("RectangleShape2D_door_trigger")

[node name="InteractionPrompt" type="Label" parent="EntryPoints/TavernEntry"]
z_index = 10
visible = false
offset_left = -50.0
offset_top = -40.0
offset_right = 50.0
offset_bottom = -15.0
theme_override_colors/font_color = Color(1, 1, 1, 1)
theme_override_colors/font_outline_color = Color(0, 0, 0, 1)
theme_override_constants/outline_size = 3
theme_override_font_sizes/font_size = 16
text = "[E] Enter Tavern"
horizontal_alignment = 1

[node name="BlacksmithEntry" type="Area2D" parent="EntryPoints"]
position = Vector2(-320, 80)
script = ExtResource("6_scene_trigger")
target_location = "thornhaven_blacksmith"
target_spawn_point = "from_exterior"
prompt_text = "Enter Smithy"

[node name="CollisionShape2D" type="CollisionShape2D" parent="EntryPoints/BlacksmithEntry"]
shape = SubResource("RectangleShape2D_door_trigger")

[node name="InteractionPrompt" type="Label" parent="EntryPoints/BlacksmithEntry"]
z_index = 10
visible = false
offset_left = -50.0
offset_top = -40.0
offset_right = 50.0
offset_bottom = -15.0
theme_override_colors/font_color = Color(1, 1, 1, 1)
theme_override_colors/font_outline_color = Color(0, 0, 0, 1)
theme_override_constants/outline_size = 3
theme_override_font_sizes/font_size = 16
text = "[E] Enter Smithy"
horizontal_alignment = 1

[node name="SpawnPoints" type="Node2D" parent="."]

[node name="default" type="Marker2D" parent="SpawnPoints"]
position = Vector2(0, 100)

[node name="from_gregor_shop" type="Marker2D" parent="SpawnPoints"]
position = Vector2(-240, -112)

[node name="from_tavern" type="Marker2D" parent="SpawnPoints"]
position = Vector2(240, -112)

[node name="from_blacksmith" type="Marker2D" parent="SpawnPoints"]
position = Vector2(-320, 96)

[node name="from_village_gate" type="Marker2D" parent="SpawnPoints"]
position = Vector2(0, 352)

[node name="Player" parent="." instance=ExtResource("1_player")]
z_index = 10
position = Vector2(0, 100)

[node name="Camera2D" type="Camera2D" parent="Player"]
zoom = Vector2(1.5, 1.5)
position_smoothing_enabled = true
position_smoothing_speed = 5.0

[node name="ElenaDaughter" parent="." groups=["npcs"] instance=ExtResource("2_elena")]
z_index = 10
position = Vector2(64, 80)

[node name="DialogueUI" type="CanvasLayer" parent="."]
script = ExtResource("3_dialogue_ui")

[node name="DialoguePanel" type="Panel" parent="DialogueUI"]
anchors_preset = 7
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
offset_left = -400.0
offset_top = -250.0
offset_right = 400.0
offset_bottom = -20.0
grow_horizontal = 2
grow_vertical = 0

[node name="VBoxContainer" type="VBoxContainer" parent="DialogueUI/DialoguePanel"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = 10.0
offset_top = 10.0
offset_right = -10.0
offset_bottom = -10.0
grow_horizontal = 2
grow_vertical = 2
theme_override_constants/separation = 5

[node name="NPCName" type="Label" parent="DialogueUI/DialoguePanel/VBoxContainer"]
layout_mode = 2
theme_override_colors/font_color = Color(1, 1, 0.6, 1)
theme_override_font_sizes/font_size = 20
text = "NPC Name"

[node name="DialogueText" type="RichTextLabel" parent="DialogueUI/DialoguePanel/VBoxContainer"]
custom_minimum_size = Vector2(0, 120)
layout_mode = 2
size_flags_vertical = 3
theme_override_font_sizes/normal_font_size = 16
bbcode_enabled = true
scroll_following = true

[node name="InputContainer" type="HBoxContainer" parent="DialogueUI/DialoguePanel/VBoxContainer"]
layout_mode = 2
theme_override_constants/separation = 5

[node name="PlayerInput" type="LineEdit" parent="DialogueUI/DialoguePanel/VBoxContainer/InputContainer"]
layout_mode = 2
size_flags_horizontal = 3
theme_override_font_sizes/font_size = 16
placeholder_text = "Type your response..."

[node name="SendButton" type="Button" parent="DialogueUI/DialoguePanel/VBoxContainer/InputContainer"]
layout_mode = 2
text = "Send"

[node name="EndButton" type="Button" parent="DialogueUI/DialoguePanel/VBoxContainer"]
layout_mode = 2
text = "End Conversation"

[node name="DebugInteractionPanel" parent="DialogueUI" instance=ExtResource("4_debug_panel")]
visible = false

[node name="DebugConsole" parent="." instance=ExtResource("5_debug_console")]

[node name="NavDebugOverlay" type="Node2D" parent="."]
script = ExtResource("9_nav_debug")

[connection signal="text_submitted" from="DialogueUI/DialoguePanel/VBoxContainer/InputContainer/PlayerInput" to="DialogueUI" method="_on_player_input_text_submitted"]
[connection signal="pressed" from="DialogueUI/DialoguePanel/VBoxContainer/InputContainer/SendButton" to="DialogueUI" method="_on_send_button_pressed"]
[connection signal="pressed" from="DialogueUI/DialoguePanel/VBoxContainer/EndButton" to="DialogueUI" method="_on_end_button_pressed"]
